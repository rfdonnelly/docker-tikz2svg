#!/bin/sh

set -x
set -e

tempdir=$(mktemp --directory)

function cleanup() {
    rm -rf $tempdir
}

trap cleanup 0

cd $tempdir
# Write stdin to file.tex
cat >file.tex

# Latex Options:
#
# * -no-shell-escape - Prevent the ability to run shell commands restricted or
# otherwise since we are potentially processing untrusted input.
# * -output-format=dvi - Make the default output explicit.
# * -halt-on-error - Halt on first error.
latex -no-shell-escape -output-format=dvi -halt-on-error file.tex 1>&2

# Dvisvgm Options:
#
# * --font-format=woff - Embeds fonts in the SVG using the Web Open Font
# Format. This increases the size of the SVG but improves font rendering.
dvisvgm --font-format=woff file.dvi

# Write file.svg to stdout
cat *.svg
